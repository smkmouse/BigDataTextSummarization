{"paragraphs":[{"text":"%md\n# Sample Code for HtmlText Extraction from Web Archives\nThis sample is meant to give you a sense of using ArchiveSpark and interact with Zeppelin.\nThe programming language is based upon Scala. Many operations in this example refers to map/reduce techniques, please do some searching online in order to get a sense of it.\nYou can use this sample code to generate a noisy corpus (original Html Text Body) as your dataset for later processing.\nYou can also use the sentence extraction part in last section to generate a relatively cleaned corpus.","user":"anonymous","dateUpdated":"2018-08-10T18:07:21+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1533924077935_1169815758","id":"20180810-180117_1881680427","dateCreated":"2018-08-10T18:01:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5137","dateFinished":"2018-08-10T18:07:10+0000","dateStarted":"2018-08-10T18:07:10+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Sample Code for HtmlText Extraction from Web Archives</h1>\n<p>This sample is meant to give you a sense of using ArchiveSpark and interact with Zeppelin.<br/>The programming language is based upon Scala. Many operations in this example refers to map/reduce techniques, please do some searching online in order to get a sense of it.<br/>You can use this sample code to generate a noisy corpus (original Html Text Body) as your dataset for later processing.<br/>You can also use the sentence extraction part in last section to generate a relatively cleaned corpus.</p>\n</div>"}]}},{"text":"%dep\n// load external dependencies\n// You need to restart the Spark interpreter in configuration of this page first in order to make the dependency take effect\nz.load(\"/archive_spark/archivespark_dlrl/libs/stanford-corenlp-3.5.1.jar\")\nz.load(\"/archive_spark/archivespark_dlrl/libs/opennlp-tools-1.9.0.jar\")\nz.load(\"/archive_spark/archivespark_dlrl/libs/en-sent.bin\")","user":"anonymous","dateUpdated":"2018-08-10T18:20:58+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res0: org.apache.zeppelin.dep.Dependency = org.apache.zeppelin.dep.Dependency@1384bf22\n"}]},"apps":[],"jobName":"paragraph_1533871299869_2079909027","id":"20180810-032139_2128869700","dateCreated":"2018-08-10T03:21:39+0000","dateStarted":"2018-08-10T18:20:58+0000","dateFinished":"2018-08-10T18:21:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:102"},{"text":"import de.l3s.archivespark._\nimport de.l3s.archivespark.implicits._\nimport de.l3s.archivespark.enrich.functions._\nimport de.l3s.archivespark.specific.warc.implicits._\nimport de.l3s.archivespark.specific.warc.specs.WarcCdxHdfsSpec\nimport de.l3s.archivespark.specific.warc.specs.WarcHdfsSpec\nimport de.l3s.archivespark.specific.warc.enrichfunctions._","user":"anonymous","dateUpdated":"2018-08-10T17:59:34+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import de.l3s.archivespark._\nimport de.l3s.archivespark.implicits._\nimport de.l3s.archivespark.enrich.functions._\nimport de.l3s.archivespark.specific.warc.implicits._\nimport de.l3s.archivespark.specific.warc.specs.WarcCdxHdfsSpec\nimport de.l3s.archivespark.specific.warc.specs.WarcHdfsSpec\nimport de.l3s.archivespark.specific.warc.enrichfunctions._\n"}]},"apps":[],"jobName":"paragraph_1533871264424_601299229","id":"20180720-134847_1824686187","dateCreated":"2018-08-10T03:21:04+0000","dateStarted":"2018-08-10T17:59:34+0000","dateFinished":"2018-08-10T17:59:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:103"},{"text":"%md\n# Load Data","user":"anonymous","dateUpdated":"2018-08-10T03:21:04+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Load Data</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1533871264430_-736421675","id":"20180720-155623_1095644148","dateCreated":"2018-08-10T03:21:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:104"},{"text":"// load data from local file system\nval warcPath = \"/archive_spark/archivespark_dlrl/data/sample_data/warc\"\nval cdxPath = \"/archive_spark/archivespark_dlrl/data/sample_data/cdx\"\nval records = ArchiveSpark.load(WarcCdxHdfsSpec(cdxPath,warcPath))\n//val recordsd_sample = records.sample(false,0.0001).cache // sample smaller set of data as needed for testing\nrecords.count","user":"anonymous","dateUpdated":"2018-08-10T18:00:06+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warcPath: String = /archive_spark/archivespark_dlrl/data/sample_data/warc\ncdxPath: String = /archive_spark/archivespark_dlrl/data/sample_data/cdx\nrecords: org.apache.spark.rdd.RDD[de.l3s.archivespark.specific.warc.WarcRecord] = MapPartitionsRDD[2] at mapPartitions at ArchiveSpark.scala:113\nres9: Long = 6000\n"}]},"apps":[],"jobName":"paragraph_1533871264431_1783569527","id":"20180720-134900_1607640404","dateCreated":"2018-08-10T03:21:04+0000","dateStarted":"2018-08-10T18:00:06+0000","dateFinished":"2018-08-10T18:00:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:105","runtimeInfos":{}},{"text":"%md\n# Process data","user":"anonymous","dateUpdated":"2018-08-10T03:21:04+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Process data</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1533871264431_243602591","id":"20180720-155618_419147609","dateCreated":"2018-08-10T03:21:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:106"},{"text":"%spark\nval pages = records.filter(r => r.mime == \"text/html\" && r.status == 200) // extract valid webpages\nval earliest = pages.distinctValue(_.surtUrl) {(a, b) => if (a.time < b.time) a else b} // filter out same urls, pick the latest snap\nval enriched = earliest.enrich(HtmlText) // Enrich with Htmltext\nenriched.peekJson","user":"anonymous","dateUpdated":"2018-08-10T18:00:10+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"pages: org.apache.spark.rdd.RDD[de.l3s.archivespark.specific.warc.WarcRecord] = MapPartitionsRDD[3] at filter at <console>:51\nearliest: org.apache.spark.rdd.RDD[de.l3s.archivespark.specific.warc.WarcRecord] = MapPartitionsRDD[6] at values at GenericHelpersRDD.scala:37\nenriched: org.apache.spark.rdd.RDD[de.l3s.archivespark.specific.warc.WarcRecord] = MapPartitionsRDD[8] at mapPartitions at EnrichableRDD.scala:40\nres11: String =\n{\n  \"record\" : {\n    \"surtUrl\" : \"com,nytimes,blogs,thelede)/2007/04/16/shooting-at-virginia-tech/comment-page-15\",\n    \"timestamp\" : \"20170328165306\",\n    \"originalUrl\" : \"https://thelede.blogs.nytimes.com/2007/04/16/shooting-at-virginia-tech/comment-page-15\",\n    \"mime\" : \"text/html\",\n    \"status\" : 200,\n    \"digest\" : \"4AR5K3ZGDNH2EREK5XRNBD4MQGM2I3RM\",\n    \"redirectUrl\" : \"-\",\n    \"meta\" : \"-\",\n    \"compressedSize\" : 25435\n  },\n  \"payload\" : {\n    \"string\" : {\n      \"html\" : {\n        \"body\" : {\n          \"text\" : \"Sections Home Search Skip to content The New York Times window.magnum.writeLogo('small', 'https://a1.nyt.com/assets/blogs/20170210-163820/images/foundation/logos/', 'General', 'masthead-theme-standard', 'standard', 'branding-heading-link', 'blogs'); The Le..."}]},"apps":[],"jobName":"paragraph_1533871264431_56673920","id":"20180720-155841_646220003","dateCreated":"2018-08-10T03:21:04+0000","dateStarted":"2018-08-10T18:00:10+0000","dateFinished":"2018-08-10T18:00:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:107","runtimeInfos":{}},{"text":"%spark\nval Terms = LowerCase.of(HtmlText).mapMulti(\"terms\") { text: String => text.split(\"\\\\W+\").distinct } // Define Terms enrichment within HTML body\nval Title = HtmlText.of(Html.first(\"title\")) // Define Title enrichment within HTML body\nval enriched = earliest.enrich(Terms).enrich(Title) // Enrich with Terms and Title\nenriched.peekJson","user":"anonymous","dateUpdated":"2018-08-10T18:00:17+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":294,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Terms: de.l3s.archivespark.enrich.DependentEnrichFunc[de.l3s.archivespark.enrich.EnrichRoot with de.l3s.archivespark.enrich.dataloads.ByteContentLoad,String] with de.l3s.archivespark.enrich.SingleField[Seq[String]] = de.l3s.archivespark.enrich.EnrichFunc$$anon$3@5aa1d433\nTitle: de.l3s.archivespark.enrich.EnrichFunc[de.l3s.archivespark.enrich.EnrichRoot with de.l3s.archivespark.enrich.dataloads.ByteContentLoad,String] with de.l3s.archivespark.enrich.DefaultFieldAccess[String,String] = de.l3s.archivespark.enrich.PipedDependentEnrichFuncWithDefaultField@4ba481e9\nenriched: org.apache.spark.rdd.RDD[de.l3s.archivespark.specific.warc.WarcRecord] = MapPartitionsRDD[12] at mapPartitions at EnrichableRDD.scala:40\nres13: String =\n{\n  \"record\" : {\n    \"surtUrl\" : \"com,nytimes,blogs,thelede)/2007/04/16/shooting-at-virginia-tech/comment-page-15\",\n    \"timestamp\" : \"20170328165306\",\n    \"originalUrl\" : \"https://thelede.blogs.nytimes.com/2007/04/16/shooting-at-virginia-tech/comment-page-15\",\n    \"mime\" : \"text/html\",\n    \"status\" : 200,\n    \"digest\" : \"4AR5K3ZGDNH2EREK5XRNBD4MQGM2I3RM\",\n    \"redirectUrl\" : \"-\",\n    \"meta\" : \"-\",\n    \"compressedSize\" : 25435\n  },\n  \"payload\" : {\n    \"string\" : {\n      \"html\" : {\n        \"body\" : {\n          \"text\" : {\n            \"lowercase\" : {\n              \"terms\" : [ \"sections\", \"home\", \"search\", \"skip\", \"to\", \"content\", \"the\", \"new\", \"york\", \"times\", \"window\", \"magnum\", \"writelogo\", \"small\", \"https\", \"a1\", \"nyt\", \"com\", \"assets\", \"blogs\", \"20170210\", \"163820\", \"im..."}]},"apps":[],"jobName":"paragraph_1533871264431_-797547676","id":"20180720-155843_702135000","dateCreated":"2018-08-10T03:21:04+0000","dateStarted":"2018-08-10T18:00:17+0000","dateFinished":"2018-08-10T18:00:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:108","runtimeInfos":{}},{"text":"// get desired information from the dataset\n// map function applies all operations inside in element wise. In this case, all elements will be distributed for parallel computation.\nval result = enriched.map( r => {\n    val title = r.valueOrElse(Title, \"\").replaceAll(\"[\\\\t\\\\n]\", \" \") // get title value \n    val text = r.valueOrElse(HtmlText, \"\").replaceAll(\"[\\\\t\\\\n]\", \" \") // get text value\n    // concatenate URL, timestamp, title and text with in the format of tuple, tuple can be converted to Dataframe format later\n    (r.originalUrl, r.timestamp,title, text)\n})","user":"anonymous","dateUpdated":"2018-08-10T18:15:52+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"result: org.apache.spark.rdd.RDD[(String, String, String, String)] = MapPartitionsRDD[13] at map at <console>:58\n"}]},"apps":[],"jobName":"paragraph_1533871264432_1506235961","id":"20180720-155845_1459444871","dateCreated":"2018-08-10T03:21:04+0000","dateStarted":"2018-08-10T03:58:52+0000","dateFinished":"2018-08-10T03:58:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:109"},{"text":"result.first //check element","user":"anonymous","dateUpdated":"2018-08-10T03:58:55+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res15: (String, String, String, String) = (https://thelede.blogs.nytimes.com/2007/04/16/shooting-at-virginia-tech/comment-page-15,20170328165306,Shooting at Virginia Tech - The New York Times,Sections Home Search Skip to content The New York Times window.magnum.writeLogo('small', 'https://a1.nyt.com/assets/blogs/20170210-163820/images/foundation/logos/', 'General', 'masthead-theme-standard', 'standard', 'branding-heading-link', 'blogs'); The Lede | Shooting at Virginia Tech Search Subscribe Now Log In 0 Settings Close search Site Search Navigation Search NYTimes.com Clear this text input Go Loading... See next articles See previous articles Site Navigation Site Mobile Navigation Supported by Search Shooting at Virginia Tech By Mike Nizza April 16, 2007 11:51 am April 16, 2007 11:51 am E..."}]},"apps":[],"jobName":"paragraph_1533871264433_-1468722297","id":"20180806-122955_115246295","dateCreated":"2018-08-10T03:21:04+0000","dateStarted":"2018-08-10T03:58:55+0000","dateFinished":"2018-08-10T03:58:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:110","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=3"],"interpreterSettingId":"spark"}}},{"text":"val result_df = result.toDF(\"originalUrl\",\"timestamp\",\"title\",\"text\") // convert to DataFrame format inorder to export Json format and perform SQL queries as needed","user":"anonymous","dateUpdated":"2018-08-10T18:14:53+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"result_df: org.apache.spark.sql.DataFrame = [originalUrl: string, timestamp: string ... 2 more fields]\n"}]},"apps":[],"jobName":"paragraph_1533871264433_2094933004","id":"20180806-123450_1928727320","dateCreated":"2018-08-10T03:21:04+0000","dateStarted":"2018-08-10T03:58:57+0000","dateFinished":"2018-08-10T03:59:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:111"},{"text":"result_df.show","user":"anonymous","dateUpdated":"2018-08-10T03:59:01+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------+--------------------+--------------------+\n|         originalUrl|     timestamp|               title|                text|\n+--------------------+--------------+--------------------+--------------------+\n|https://thelede.b...|20170328165306|Shooting at Virgi...|Sections Home Sea...|\n|http://transcript...|20170328165301|CNN.com - Transcr...|.cnnCeilIntlEd {p...|\n|http://www.cbc.ca...|20170328165302|33 dead in 'horri...|try{ if(!CBC) { v...|\n|http://www.washin...|20170328165300|An 'Abundant Life...|var saveshare_rec...|\n|http://wwwwakeupa...|20170328165315|Wake up America: ...|Pages Home Twitte...|\n|http://lawhawk.bl...|20170328165313|        A Blog Fo...|function setAttri...|\n|http://ma.gnolia....|20170328165315|Abbigliamento - 6...|Links.render(\"CiA...|\n|http://www.washin...|20170328165300|Gunman Who Killed...|var saveshare_rec...|\n|http://www.washin...|20170328165300|Which Way Isn't a...|if ( show_doublec...|\n|https://thelede.b...|20170328165305|Shooting at Virgi...|Sections Home Sea...|\n|http://ummadam.wo...|20170328165314|What Is This Worl...|Soliloquies of A ...|\n|http://www.washin...|20170328165300|'Die-In' Counts t...|if ( show_doublec...|\n|http://www.washin...|20170328165259|Gunman Sent Video...|var saveshare_rec...|\n|http://www.floppi...|20170328165314|What did French I...|window.fbAsyncIni...|\n|http://www.mujahi...|20170328165313|Virgina Tech Trag...|The End - 2000 to...|\n|http://wwwwakeupa...|20170328165315|Wake up America: ...|Pages Home Twitte...|\n|http://thinkingon...|20170328165313| Thinking on the ...|function setAttri...|\n|http://www.washin...|20170328165300|Mourning Reaches ...|var saveshare_rec...|\n|https://tr.wikipe...|20170328165302|Virginia Tech kat...|document.write(\"\\...|\n|https://thelede.b...|20170328165305|Shooting at Virgi...|Sections Home Sea...|\n+--------------------+--------------+--------------------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533871264433_-1226779091","id":"20180806-124107_980581038","dateCreated":"2018-08-10T03:21:04+0000","dateStarted":"2018-08-10T03:59:01+0000","dateFinished":"2018-08-10T03:59:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:112","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=4"],"interpreterSettingId":"spark"}}},{"text":"%md\n# Export Data","user":"anonymous","dateUpdated":"2018-08-10T03:59:06+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Export Data</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1533871264433_-1662513732","id":"20180809-224749_2059017988","dateCreated":"2018-08-10T03:21:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:113","dateFinished":"2018-08-10T03:59:09+0000","dateStarted":"2018-08-10T03:59:06+0000"},{"text":"result_df.repartition(1).write.mode(\"overwrite\").format(\"json\").save(\"/share_dir/sample_output/\") // export data to your local path","user":"anonymous","dateUpdated":"2018-08-10T18:51:21+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533871264434_1997304782","id":"20180806-124121_418500371","dateCreated":"2018-08-10T03:21:04+0000","dateStarted":"2018-08-10T03:59:12+0000","dateFinished":"2018-08-10T03:59:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:114","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=5"],"interpreterSettingId":"spark"}}},{"text":"%md\n# Further extract with clean sentences","user":"anonymous","dateUpdated":"2018-08-10T03:21:04+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Further extract with clean sentences</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1533871264434_-1487574428","id":"20180809-225059_722808891","dateCreated":"2018-08-10T03:21:04+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:115"},{"text":"import java.io.{FileOutputStream, PrintStream,FileInputStream,PrintWriter}\nimport opennlp.tools.sentdetect.SentenceDetectorME\nimport opennlp.tools.sentdetect.SentenceModel\nimport org.apache.spark.SparkFiles\nimport org.apache.spark.sql.{Row, SparkSession}","user":"anonymous","dateUpdated":"2018-08-10T18:21:10+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import java.io.{FileOutputStream, PrintStream, FileInputStream, PrintWriter}\nimport opennlp.tools.sentdetect.SentenceDetectorME\nimport opennlp.tools.sentdetect.SentenceModel\nimport org.apache.spark.SparkFiles\nimport org.apache.spark.sql.{Row, SparkSession}\n"}]},"apps":[],"jobName":"paragraph_1533871264434_-2001251433","id":"20180809-225059_1002553923","dateCreated":"2018-08-10T03:21:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:116","dateFinished":"2018-08-10T18:21:18+0000","dateStarted":"2018-08-10T18:21:10+0000"},{"text":"// get Array of elements: URL, timestamp, HtmlText\nval extracted = enriched.map(r => {\n      val text = r.valueOrElse(HtmlText, \"\").replaceAll(\"[\\\\t\\\\n]\", \" \")\n      Array[String](r.originalUrl, r.timestamp, text)\n    })","user":"anonymous","dateUpdated":"2018-08-10T18:00:23+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1533871264435_1131631783","id":"20180809-225058_915692249","dateCreated":"2018-08-10T03:21:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:117","dateFinished":"2018-08-10T18:00:24+0000","dateStarted":"2018-08-10T18:00:23+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"extracted: org.apache.spark.rdd.RDD[Array[String]] = MapPartitionsRDD[13] at map at <console>:63\n"}]}},{"text":"// clean html text with OpenNLP tool\n// notice we use mapPartitions instead of map here: mapPartitions function apply operations in partition wise. In this case, elements are pre-distribted to different partitions, each partition will perform same operations and apply them to given records. In this particular example, the file loading and model initialization operations are heavy and can not be serialized in element wise, thus we have to use mapPartitions instead of map. \nval cleaned = extracted.mapPartitions(partition => {\n      val path = SparkFiles.get(\"en-sent.bin\") // get file path from --files option\n      val en_sent = new FileInputStream(path) // read external file\n      val model = new SentenceModel(en_sent) // create sentence model\n      val detector = new SentenceDetectorME(model) // create sentence detector\n      val regex = \"[A-Za-z0-9\\\\,\\\\.\\\\-\\\\;\\\\:\\\\(\\\\)\\\\'\\\\& ]+\\\\.\" // regex for filtering\n\n      partition.map(r => {\n        val sentences = detector.sentDetect(r(2)).filter(_.matches(regex)).mkString(\" \") // apply sentence detector\n        (r(0), r(1), sentences) // return URL, timestamp, sentences\n      })\n\n    })","user":"anonymous","dateUpdated":"2018-08-10T18:13:58+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1533871264435_-1236596059","id":"20180809-225100_702519539","dateCreated":"2018-08-10T03:21:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:118","dateFinished":"2018-08-10T18:00:25+0000","dateStarted":"2018-08-10T18:00:25+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"cleaned: org.apache.spark.rdd.RDD[(String, String, String)] = MapPartitionsRDD[14] at mapPartitions at <console>:65\n"}]}},{"text":"val cleaned_df = cleaned.toDF(\"URL\", \"Timestamp\", \"Sentences\") // convert to DataFrame format","user":"anonymous","dateUpdated":"2018-08-10T18:00:26+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1533871264435_605784428","id":"20180809-225700_272551232","dateCreated":"2018-08-10T03:21:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:119","dateFinished":"2018-08-10T18:00:29+0000","dateStarted":"2018-08-10T18:00:26+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"cleaned_df: org.apache.spark.sql.DataFrame = [URL: string, Timestamp: string ... 1 more field]\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1533924031541_-93370518","id":"20180810-180031_660303914","dateCreated":"2018-08-10T18:00:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5000","text":"cleaned_df.show","dateUpdated":"2018-08-10T18:00:35+0000","dateFinished":"2018-08-10T18:00:38+0000","dateStarted":"2018-08-10T18:00:35+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------+--------------------+\n|                 URL|     Timestamp|           Sentences|\n+--------------------+--------------+--------------------+\n|https://thelede.b...|20170328165306|Clear this text i...|\n|http://transcript...|20170328165301|THIS COPY MAY NOT...|\n|http://www.cbc.ca...|20170328165302|TV Radio News Spo...|\n|http://www.washin...|20170328165300|(Photos By Gerald...|\n|http://wwwwakeupa...|20170328165315|Custom Search Mon...|\n|http://lawhawk.bl...|20170328165313|As the 11th most ...|\n|http://ma.gnolia....|20170328165315|                    |\n|http://www.washin...|20170328165300|Tech Dormitory TO...|\n|http://www.washin...|20170328165300|Cho was an immigr...|\n|https://thelede.b...|20170328165305|Clear this text i...|\n|http://ummadam.wo...|20170328165314|Although we do no...|\n|http://www.washin...|20170328165300|Orange and maroon...|\n|http://www.washin...|20170328165259|(By Linda Davidso...|\n|http://www.floppi...|20170328165314|This puts the evi...|\n|http://www.mujahi...|20170328165313|Talibah Al Ilm Ap...|\n|http://wwwwakeupa...|20170328165315|Custom Search Tue...|\n|http://thinkingon...|20170328165313|Many students cho...|\n|http://www.washin...|20170328165300|Back Mourning Rea...|\n|https://tr.wikipe...|20170328165302|Commonwealth of V...|\n|https://thelede.b...|20170328165305|Clear this text i...|\n+--------------------+--------------+--------------------+\nonly showing top 20 rows\n\n"}]},"runtimeInfos":{}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1533923073839_-1854618399","id":"20180810-174433_264194165","dateCreated":"2018-08-10T17:44:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2981","text":"cleaned_df.repartition(1).write.mode(\"overwrite\").format(\"json\").save(\"/share_dir/sample_output/sentences\") // export data to your local path","dateUpdated":"2018-08-10T18:51:28+0000","dateFinished":"2018-08-10T18:00:57+0000","dateStarted":"2018-08-10T18:00:46+0000","results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1533923170002_1859979740","id":"20180810-174610_322267156","dateCreated":"2018-08-10T17:46:10+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3174"}],"name":"SampleCode/HtmlText_extraction","id":"2DKK9J3AV","noteParams":{},"noteForms":{},"angularObjects":{},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}